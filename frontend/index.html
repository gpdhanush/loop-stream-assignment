<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Currency Converter - VueJS</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=Chivo+Mono:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="stylesheet" href="./style.css" />

  <!-- Vue 3 CDN (development build) -->
  <!-- <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script> -->

  <!-- Vue 3 CDN (production build) -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
</head>

<body class="bg-slate-50 text-slate-900">
  <div id="app" class="app-container min-h-screen">
    <div v-if="isGlobalLoading" class="full-page-loader" aria-live="polite">
      <div class="loader-card">
        <span class="loader" aria-hidden="true"></span>
        <span class="loading-text">Loading...</span>
      </div>
    </div>
    <header class="header">
      <div class="header-inner">
        <h1>Currency Converter</h1>
      </div>
    </header>
    <div class="container converter-section">

      <!-- SECTION 1 -->
      <div class="card section section-one converter-card">

        <div class="converter-shell converter-inputs">
          <div class="panel input-group">
            <div class="panel-label">Amount</div>
            <div class="panel-box input-with-select">
              <span v-if="selectedFromCurrency.symbol && selectedFromCurrency.symbolFirst" class="amount-symbol">
                {{ selectedFromCurrency.symbol }}
              </span>
              <input class="amount-input mono" type="text" inputmode="numeric" pattern="[0-9]*"
                :value="formatThousands(amount)" @input="handleAmountInput" />
              <span v-if="selectedFromCurrency.symbol && !selectedFromCurrency.symbolFirst" class="amount-symbol amount-symbol--right">
                {{ selectedFromCurrency.symbol }}
              </span>
              <div class="currency-dropdown currency-select" :class="{ open: showFromDropdown }">
                <button class="currency-trigger" type="button" @click="toggleDropdown('from')">
                  <img class="flag-icon" :src="selectedFromCurrency.flagUrl" :alt="selectedFromCurrency.code" />
                  <span class="code">{{ selectedFromCurrency.code }}</span>
                  <span class="chev">▾</span>
                </button>
                <div class="dropdown-panel">
                  <input class="input dropdown-search" placeholder="Search currency" v-model="fromSearch"
                    ref="fromSearchInput" />
                  <div class="dropdown-list">
                    <button v-for="c in filteredCurrencyListFrom" :key="c.code" type="button" class="dropdown-item"
                      @click="selectCurrency('from', c.code)">
                      <img class="flag-icon" :src="c.flagUrl" :alt="c.code" />
                      <span class="code">{{ c.code }}</span>
                      <span class="name">- {{ c.name }}</span>
                      <!-- <span v-if="c.symbol" class="symbol">{{ c.symbol }}</span> -->
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div v-if="amountErrorMessage" class="error-text amount-error">
              {{ amountErrorMessage }}
            </div>
          </div>

          <div class="swap-wrap">
            <button class="swap-btn swap-button" @click="swapCurrencies" title="Swap currencies">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M7 16V4M7 4L3 8M7 4L11 8M17 8V20M17 20L21 16M17 20L13 16" />
              </svg>
            </button>
          </div>

          <div class="panel input-group">
            <div class="panel-label">Converted to</div>
            <div class="panel-box panel-box--split input-with-select">
              <span v-if="selectedToCurrency.symbol && selectedToCurrency.symbolFirst" class="amount-symbol">
                {{ selectedToCurrency.symbol }}
              </span>
              <input class="amount-input mono" type="text" inputmode="numeric" pattern="[0-9]*"
                :value="formatThousands(convertedInput)" @input="handleConvertedInput" />
              <span v-if="selectedToCurrency.symbol && !selectedToCurrency.symbolFirst" class="amount-symbol amount-symbol--right">
                {{ selectedToCurrency.symbol }}
              </span>
              <div class="currency-dropdown currency-select" :class="{ open: showToDropdown }">
                <button class="currency-trigger" type="button" @click="toggleDropdown('to')">
                  <img class="flag-icon" :src="selectedToCurrency.flagUrl" :alt="selectedToCurrency.code" />
                  <span class="code">{{ selectedToCurrency.code }}</span>
                  <span class="chev">▾</span>
                </button>
                <div class="dropdown-panel">
                  <input class="input dropdown-search" placeholder="Search currency" v-model="toSearch"
                    ref="toSearchInput" />
                  <div class="dropdown-list">
                    <button v-for="c in filteredCurrencyListTo" :key="c.code" type="button" class="dropdown-item"
                      @click="selectCurrency('to', c.code)">
                      <img class="flag-icon" :src="c.flagUrl" :alt="c.code" />
                      <span class="code">{{ c.code }}</span>
                      <span class="name">— {{ c.name }}</span>
                      <span v-if="c.symbol" class="symbol">{{ c.symbol }}</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div v-if="convertedErrorMessage" class="error-text amount-error">
              {{ convertedErrorMessage }}
            </div>
          </div>
        </div>

        <div class="rate-summary">
          <div v-if="convertLoading" class="loading-row">
            <span class="loader" aria-hidden="true"></span>
            <span class="loading-text">Converting...</span>
          </div>
          <div v-else class="rate-value">
            1 {{ fromCurrency }} = {{ formattedRate }} {{ toCurrency }}
          </div>
          <!-- <div class="rate-sub">Mid-market rate</div> -->
          <div v-if="convertError" class="error-text">
            {{ convertError }}
          </div>
        </div>
      </div>

      <!-- SECTION 2 -->
      <div class="card section rates-section">
        <div class="rates-header section-header">
          <h2 class="section-title">Exchange Rates (Base: {{ latestBase || "-" }})</h2>

          <div class="rates-actions">
            <button class="refresh-btn" @click="fetchLatestRates" :disabled="latestLoading">
              <svg class="refresh-icon h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12a9 9 0 0 1 15.54-6.36" />
                <path d="M21 3v6h-6" />
                <path d="M21 12a9 9 0 0 1-15.54 6.36" />
                <path d="M3 21v-6h6" />
              </svg>
              {{ latestLoading ? "Refreshing..." : "Refresh" }}
            </button>
          </div>
        </div>
        <div class="section-search rates-search">
          <input class="input filter-input" placeholder="Search currency..." v-model="latestSearch" />
          <label class="popular-toggle">
            <input class="toggle-input" type="checkbox" v-model="showPopularOnly" />
            <span class="toggle-track">
              <span class="toggle-thumb"></span>
            </span>
            <span class="toggle-label">Popular only</span>
          </label>
        </div>
        <div class="table-wrap rates-table">
          <table class="table">
            <thead>
              <tr>
                <th class="sortable" @click="toggleSort('currency')" :class="{ active: sortBy === 'currency' }">
                  <div class="inline-flex items-center gap-1">
                    Currency
                    <span class="sort-icon" :class="{ active: sortBy === 'currency' }">
                      <svg v-if="sortBy !== 'currency'" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4"
                        viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 3a1 1 0 01.894.553l3 6A1 1 0 0113 11H7a1 1 0 01-.894-1.447l3-6A1 1 0 0110 3z" />
                        <path d="M10 17a1 1 0 01-.894-.553l-3-6A1 1 0 017 9h6a1 1 0 01.894 1.447l-3 6A1 1 0 0110 17z" />
                      </svg>
                      <svg v-else-if="sortOrder === 'asc'" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4"
                        viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 3a1 1 0 01.894.553l3 6A1 1 0 0113 11H7a1 1 0 01-.894-1.447l3-6A1 1 0 0110 3z" />
                      </svg>
                      <svg v-else xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path d="M10 17a1 1 0 01-.894-.553l-3-6A1 1 0 017 9h6a1 1 0 01.894 1.447l-3 6A1 1 0 0110 17z" />
                      </svg>
                    </span>
                  </div>
                </th>
                <th class="right sortable" @click="toggleSort('rate')" :class="{ active: sortBy === 'rate' }">
                  <div class="inline-flex items-center justify-end gap-1">
                    Online sell rate
                    <span class="sort-icon" :class="{ active: sortBy === 'rate' }">
                      <svg v-if="sortBy !== 'rate'" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4"
                        viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 3a1 1 0 01.894.553l3 6A1 1 0 0113 11H7a1 1 0 01-.894-1.447l3-6A1 1 0 0110 3z" />
                        <path d="M10 17a1 1 0 01-.894-.553l-3-6A1 1 0 017 9h6a1 1 0 01.894 1.447l-3 6A1 1 0 0110 17z" />
                      </svg>
                      <svg v-else-if="sortOrder === 'asc'" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4"
                        viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 3a1 1 0 01.894.553l3 6A1 1 0 0113 11H7a1 1 0 01-.894-1.447l3-6A1 1 0 0110 3z" />
                      </svg>
                      <svg v-else xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path d="M10 17a1 1 0 01-.894-.553l-3-6A1 1 0 017 9h6a1 1 0 01.894 1.447l-3 6A1 1 0 0110 17z" />
                      </svg>
                    </span>
                  </div>
                </th>
              </tr>
            </thead>

            <tbody>
              <tr v-if="latestLoading">
                <td colspan="2" class="center muted">Loading rates...</td>
              </tr>

              <tr v-else-if="latestError">
                <td colspan="2" class="center error-text">
                  {{ latestError }}
                </td>
              </tr>

              <tr v-else-if="filteredLatestRates.length === 0">
                <td colspan="2" class="center muted">
                  No results found
                </td>
              </tr>

              <tr v-for="row in filteredLatestRates" :key="row.code">
                <td>
                  <div class="currency-name">
                    <img class="flag-icon" :src="row.flag" :alt="row.code" />
                    <strong>{{ row.name }} ({{ row.code }}) </strong>
                  </div>
                </td>
                <td class="right mono">
                  {{ formatRate(row.rate) }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="small-muted">
          Base currency from API: <strong>{{ latestBase }}</strong>
        </div>

      </div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>

</html>